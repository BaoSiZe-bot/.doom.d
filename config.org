#+TITLE: My Doom Emacs Config
#+author: baosize-bot
#+PROPERTY: header-args

* æ¦‚è¿°
#+begin_quote
â€œI'm rarely happier than when spending an entire day programming my computer to perform automatically a task that would otherwise take me a good ten seconds to do by hand.â€ - Douglas Adams
#+end_quote

æˆ‘ç”¨ [[https://github.com/doomemacs/doomemacs/][Doom Emacs]]ï¼ˆä»¥ä¸‹ç®€ç§°Doomï¼‰ä½œä¸º Emacs åŸºæœ¬é…ç½®ã€‚è¿™æ˜¯ä¸€ä¸ªliterateé…ç½®æ–‡ä»¶, æŒ‡å®šäº†Doomçš„æ‰€æœ‰é…ç½®å¹¶åŒ…å«äº†æ–‡æ¡£ã€‚å¦‚æœå°†è¿™ä¸ªæ–‡ä»¶å¯¼å…¥åˆ° =~/.doom.d/config.org= ï¼ŒDoom ä¼šåœ¨å¯åŠ¨æˆ–æ­¤æ–‡ä»¶å˜åŠ¨æ—¶æ—¶è‡ªåŠ¨ tangle æ­¤æ–‡ä»¶ä¸­çš„ä»£ç åˆ°å¯¹åº”çš„æ–‡ä»¶ä¸­ã€‚

å¦‚æœä½ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å¯ä»¥è€ƒè™‘åœ¨ Emacs Org mode ä¸­æ‰“å¼€å®ƒä»¥è·å¾—æ›´å¥½çš„é˜…è¯»ä½“éªŒ :).

åœ¨æ›´æ”¹å„ç§package.elå’Œinit.elåï¼Œè¯·è®°å¾—è¿è¡Œ =doom sync= ã€‚

è¿™ä¸ªé…ç½®ä»åœ¨ä¸æ–­ä¼˜åŒ–ä¸­ï¼Œç›®å‰å¯åŠ¨é€Ÿåº¦ææ…¢ï¼Œè¾¾ 0.7s ã€‚
** çµæ„Ÿ

- [[https://github.com/cnsunyour/.doom.d][cnsunyour's Doom Emacs]]
- [[https://github.com/manateelazycat/lazycat-emacs][Lazycat Emacs]]
- [[https://github.com/h0cheung/doom-emacs-config][H-cheung's Doom Emacs]] æœ¬é…ç½®åŸºäºæ­¤ä¿®æ”¹è€Œæ¥ã€‚

* ç›®å½• :QUOTE:TOC_3:
#+BEGIN_QUOTE
- [[#æ¦‚è¿°][æ¦‚è¿°]]
  - [[#çµæ„Ÿ][çµæ„Ÿ]]
- [[#initel][init.el]]
- [[#configel][config.el]]
- [[#packagesel][packages.el]]
- [[#ä¸ªäººæ¨¡å—][ä¸ªäººæ¨¡å—]]
  - [[#meow][meow]]
  - [[#baosize][baosize]]
    - [[#awesome-tray][awesome-tray]]
    - [[#blink-search][blink-search]]
    - [[#color-rg][color-rg]]
    - [[#eaf][EAF]]
    - [[#holo-layer][holo-layer]]
    - [[#sort-tab][sort-tab]]
    - [[#chinese][chinese]]
    - [[#lsp][lsp]]
    - [[#mycorfu][mycorfu]]
    - [[#themes][themes]]
    - [[#tools][tools]]
    - [[#treesit-context][treesit-context]]
    - [[#vterm-run][vterm-run]]
#+END_QUOTE

* init.el
æœ¬éƒ¨åˆ†å†³å®šäº†Doomæ‰€å¯ç”¨çš„æ¨¡å—å’ŒåŠ è½½é¡ºåºã€‚
#+begin_src emacs-lisp :tangle init.el
;;; init.el -*- lexical-binding: t; -*-
(doom! :completion
;;     (corfu +icons +orderless +dabbrev)
       (vertico +icons)           ; the search engine of the future

       :ui
       ;;deft              ; notational velocity for Emacs
       doom              ; what makes DOOM look the way it does
       doom-dashboard
       modeline
       (popup +defaults)
       hl-todo           ; highlight TODO/FIXME/NOTE/DEPRECATED/HACK/REVIEW
       ;;indent-guides     ; highlighted indent columns
       ;; ligatures         ; ligatures and symbols to make your code pretty again
       ;; minimap           ; show a map of the code on the side
       (vc-gutter +pretty) ; vcs diff in the fringe
       workspaces        ; tab emulation, persistence & separate workspaces

       :checkers
       (syntax +childframe +flymake)             ; tasing you for every semicolon you forget

       :editor
       meow
       ;; file-templates    ; auto-snippets for empty files
       ;; fold              ; (nigh) universal code folding
       ;; format
       snippets          ; my elves. They type so I don't have to

       :emacs
       ;; (ibuffer +icons)
       ;; (dired +icons +dirvish)
       ;; electric
       ;; vc
       ;; undo              ; persistent, smarter undo for your inevitable mistakes

       :term
       ;; eshell            ; the elisp shell that works everywhere
       vterm                  ; the best terminal emulation

       :tools
       eval     ; run code, run (also, repls)
       editorconfig
       ;;(lsp +peek +eglot)
       ;; debugger
       magit             ; a git porcelain for Emacs
       ;; (lookup +dictionary +docsets)             ; navigate your code and its documentation

       :os
       ;; tty

       :lang
       ;;(cc +lsp)
       ;;(json +lsp)
       ;;(python +lsp +pyright +cpython)
       ;;(yaml +lsp)
       ;;(sh +lsp)
       emacs-lisp        ; drown in parentheses
       markdown          ; writing docs for people to ignore
       (org +pretty)              ; organize your plain life in plain text

       :email
       ;;(mu4e +org +gmail)
       ;;notmuch
       ;;(wanderlust +gmail)

       :config
       literate
       ;;use-package
       (default +bindings)

       :baosize
       ;;themes
       chinese
       tools
       ;;awesome-tray
       ;; holo-layer
       eaf
       blink-search
       ;; ;;dape
       sort-tab
       (mycorfu +icons)
       color-rg
       lsp
       treesit-context
       ;; aweshell
       vterm-run
       flymake)
#+end_src
* config.el
:PROPERTIES:
:header-args: :tangle config.el
:END:
#+begin_src emacs-lisp
;;; $DOOMDIR/config.el -*- lexical-binding: t; -*-
#+end_src
85%çœŸé€æ˜ï¼ˆåªé€æ˜èƒŒæ™¯ï¼Œä¸é€æ˜æ–‡å­—ï¼‰
#+begin_src emacs-lisp
(add-to-list 'default-frame-alist '(alpha-background . 85))
#+end_src
moonlight ä¸»é¢˜
#+begin_src emacs-lisp
(setq doom-theme 'doom-moonlight)
#+end_src
VictorMono & éœé¹œæ–‡æ¥·ï¼Œemojiè®¾ç½®ç‰¹æ®Šå­—ä½“
#+begin_src emacs-lisp
(setq doom-font (font-spec :family "VictorMono Nerd Font" :size 17 :weight 'Regular)
      doom-symbol-font (font-spec :family "éœé¹œæ–‡æ¥·" :size 17 :weight 'Regular)
      doom-variable-pitch-font (font-spec :family "éœé¹œæ–‡æ¥·" :size 17 :weight 'Regular)
      doom-big-font (font-spec :family "VictorMono Nerd Font" :size 20 :weight 'Regular)
      nerd-icons-font-family "VictorMono Nerd Font")
(set-fontset-font t 'han (font-spec :family "éœé¹œæ–‡æ¥·" :size 19 :weight 'Regular))
(defun +font-set-emoji (&rest _)
  (set-fontset-font t 'emoji "Noto Color Emoji" nil 'prepend))
(add-hook 'after-setting-font-hook #'+font-set-emoji)
#+end_src
Treesitter é»˜è®¤çš„é«˜äº®å¤ªç´ äº†ï¼Œä½†æ˜¯å®šä¹‰å¤šäº†å½±å“é€Ÿåº¦ï¼Œè®¾ç½®ä¸€ä¸‹jit-lock-defer-time
#+begin_src emacs-lisp
(setq treesit-font-lock-level 4
      major-mode-remap-alist
      '((yaml-mode . yaml-ts-mode)
        (sh-mode . bash-ts-mode)
        (js-mode . js-ts-mode)
        (css-mode . css-ts-mode)
        (c-mode . c-ts-mode)
        (c++-mode . c++-ts-mode)
        (c-or-c++-mode . c-or-c++-ts-mode)
        (python-mode . python-ts-mode)))
(defun my-fontify-variable (node override start end &rest _)
  (let ((parent (treesit-node-parent node)) tyn)
    (catch 'break
      (while parent
        (setq tyn (treesit-node-type parent))
        (cond ((or (equal tyn "call_expression") (equal tyn "template_function"))
               (progn
                 (treesit-fontify-with-override (treesit-node-start node) (treesit-node-end node) 'font-lock-function-call-face override start end)
                 (throw 'break nil))))
        (cond ((or (equal tyn "argument_list") (equal tyn "field_expression")) (progn (setq parent nil) (throw 'break nil))))
        (cond (t (setq parent (treesit-node-parent parent))))))
    (when (not parent) (treesit-fontify-with-override (treesit-node-start node) (treesit-node-end node) 'font-lock-variable-use-face override start end))))
(advice-add 'c-ts-mode--fontify-variable :around (lambda (fn &rest args) (eval `(my-fontify-variable ,@args))))
(defun my-c-font-lock-settings (fn mode)
  (if (eq mode 'cpp)
      `(
        ,@(treesit-font-lock-rules
           :language 'cpp
           :feature 'function
           '((destructor_name (identifier) @font-lock-function-name-face))
           :language mode
           :feature 'property
           '((template_method (field_identifier) @font-lock-function-call-face)))
        ,@(funcall fn mode))
    (funcall fn mode)))
(advice-add 'c-ts-mode--font-lock-settings :around 'my-c-font-lock-settings)
(add-hook 'meow-insert-mode-hook (lambda () (setq jit-lock-defer-time 0.25)))
(add-hook 'meow-normal-mode-hook (lambda () (setq jit-lock-defer-time 0)))
#+end_src
C++ ç¼©è¿›å’Œè°ƒè¯•
#+begin_src emacs-lisp
(add-hook 'c++-ts-mode-hook (lambda ()
(setq c-basic-offset 4)
(rainbow-delimiters-mode-enable)
(bind-key "C-c d c" #'cpp-gdb 'c++-ts-mode-map)
 (defun cpp-gdb ()
   (interactive)
   (if buffer-file-name
       (let ((filename (file-name-sans-extension (file-name-nondirectory buffer-file-name))))
         (when (eq 0 (shell-command (concat "g++ -g3 -std=c++17 " buffer-file-name " -o /tmp/cpp-" filename)))
           (gdb (concat "gdb -i=mi /tmp/cpp-" filename))))
     (message "buffer-file-name is nil")))))
#+end_src
Org-mode ç›¸å…³
#+begin_src emacs-lisp
(bind-keys ("C-c f o" . consult-org-agenda))
(remove-hook 'org-mode-hook #'+literate-enable-recompile-h)
#+end_src
ç”±äºæœ¬äººä½¿ç”¨fishä½œä¸ºé»˜è®¤shellæ‰€ä»¥è¦åšä¸€ç‚¹æ“ä½œæ‰è¡Œ
#+begin_src emacs-lisp
(setq shell-file-name (executable-find "bash"))
(setq-default vterm-shell (executable-find "fish"))
(setq-default explicit-shell-file-name (executable-find "fish"))
#+end_src
æ‚¬æµ®çª—å£
corfu è²Œä¼¼ä¸åº”è¯¥å‡ºç°åœ¨è¿™é‡Œï¼Œä½†æ˜¯ä¸æ”¾è¿™é‡Œå°±æ²¡æ³•å·¥ä½œ
#+begin_src emacs-lisp 
(standard-display-unicode-special-glyphs) ; ç»ˆç«¯ä¸­çš„å¼¹çª—ä¸è®¾ç½®ä¼šä½¿ç”¨ASCIIè¾¹æ¡†
(with-eval-after-load 'corfu
  (global-corfu-mode)
  (add-hook 'corfu-mode-hook #'corfu-popupinfo-mode))
#+end_src
åˆ«å†æé†’æˆ‘ "Really kill emacs?" äº†ã€‚
ä» manateelazycat å¤§ä½¬çš„é…ç½®ä¸ŠæŠ„çš„ï¼Œä½†æˆ‘å¹¶ä¸çŸ¥é“æ–°è¯­æ³• advice-add æ€ä¹ˆç”¨ã€‚
#+begin_src emacs-lisp
;; (advice-add 'save-buffer-kill-emacs :around (lambda (fn &rest)
;;   (require 'noflet)
;;   (setq confirm-kill-emacs nil)
;;   (noflet (process-list) ad-do-it)))
(defadvice save-buffers-kill-emacs (around no-query-kill-emacs activate)
  "Prevent annoying \"Active processes exist\" query when you quit Emacs."
  (require 'noflet)
  (setq confirm-kill-emacs nil)
  (noflet (process-list) ad-do-it))
#+end_src
è‡ªå®šä¹‰Variableså’ŒFaces
æˆ‘ä¸çŸ¥é“è¿™æ˜¯å¹²å˜›ç”¨çš„ï¼Œä½†å®ƒæ—¢ç„¶åœ¨è¿™é‡Œâ€¦â€¦
#+begin_src emacs-lisp
(custom-set-variables)
;; custom-set-variables was added by Custom.
;; If you edit it by hand, you could mess it up, so be careful.
;; Your init file should contain only one such instance.
;; If there is more than one, they won't work right.
(custom-set-faces)
;; custom-set-faces was added by Custom.
;; If you edit it by hand, you could mess it up, so be careful.
;; Your init file should contain only one such instance.
;; If there is more than one, they won't work right.
#+end_src
* packages.el
Emacs æ ¸å¿ƒæ‰€éœ€çš„æ’ä»¶
#+begin_src emacs-lisp :tangle packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/packages.el
(unpin! t)
;;(package! vc-msg)
;;(package! power-mode)
;;(package! imenu-list)
(package! noflet)
(package! cal-china-x)
;;(package! railgun :recipe(:host github :repo "gynamics/railgun.el"))
#+end_src
* ä¸ªäººæ¨¡å—
** meow
Evilå®åœ¨æ˜¯å¤ªé‡äº†ï¼Œä½†æˆ‘åˆæ— æ³•é€‚åº”EmacsåŸç”ŸæŒ‰é”®ï¼Œå°±ä½¿ç”¨è½»é‡çº§çš„Meowäº†
=M-x meow-tutor= ä»¥å­¦ä¹ MeowæŒ‰é”®ï¼ˆç±»ä¼¼äºvim-tutorï¼‰
#+begin_src emacs-lisp :tangle modules/editor/meow/packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/editor/meow/packages.el

(package! meow)
#+end_src
#+begin_src emacs-lisp :tangle modules/editor/meow/config.el
;;; editor/meow/config.el -*- lexical-binding: t; -*-
(defun meow/setup ()
  (setq meow-use-cursor-position-hack t
        meow-use-clipboard t
        meow-use-enhanced-selection-effect t)
  (bind-keys :map meow-normal-state-keymap
             ("0" . meow-expand-0)
             ("1" . meow-expand-1)
             ("2" . meow-expand-2)
             ("3" . meow-expand-3)
             ("4" . meow-expand-4)
             ("5" . meow-expand-5)
             ("6" . meow-expand-6)
             ("7" . meow-expand-7)
             ("8" . meow-expand-8)
             ("9" . meow-expand-9)
             ("-" . negative-argument)
             (";" . meow-reverse)
             ("," . meow-inner-of-thing)
             ("." . meow-bounds-of-thing)
             ("'" . repeat)))
(defun meow-append-this-line ()
  (interactive)
  (move-end-of-line 1)
  (meow-insert))
(defun meow-insert-this-line ()
  (interactive)
  (move-beginning-of-line 1)
  (meow-insert))
(defun meow/setup-qwerty ()
  (setq meow-cheatsheet-layout meow-cheatsheet-layout-qwerty)
  (meow/setup)
  (bind-keys :map meow-normal-state-keymap
   ("[" . meow-beginning-of-thing)
   ("]" . meow-end-of-thing)
   ("a" . meow-append)
   ("o" . meow-open-below)
   ("A" . meow-append-this-line)
   ("b" . meow-back-word)
   ("B" . meow-back-symbol)
   ("c" . meow-change)
   ("e" . meow-next-word)
   ("E" . meow-next-symbol)
   ("f" . meow-find)
   ("g" . meow-cancel-selection)
   ("G" . meow-grab)
   ("h" . meow-left)
   ("H" . meow-left-expand)
   ("i" . meow-insert)
   ("I" . meow-insert-this-line)
   ("O" . meow-open-above)
   ("j" . meow-next)
   ("J" . meow-next-expand)
   ("k" . meow-prev)
   ("K" . meow-prev-expand)
   ("l" . meow-right)
   ("L" . meow-right-expand)
   ("v" . meow-visit)
   ("m" . meow-join)
   ("n" . meow-search)
   ("%" . meow-block)
   ("p" . meow-yank)
   ("q" . meow-quit)
   ("Q" . meow-goto-line)
   ("r" . meow-replace)
   ("R" . meow-swap-grab)
   ("d" . meow-kill)
   ("t" . meow-till)
   ("u" . meow-undo)
   ("U" . meow-undo-in-selection)
   ("/" . meow-comment)
   ("w" . meow-mark-word)
   ("W" . meow-mark-symbol)
   ("x" . meow-line)
   ("X" . meow-goto-line)
   ("y" . meow-save)
   ("Y" . meow-sync-grab)
   ("z" . meow-pop-selection)))

(use-package meow
  :hook (doom-after-modules-config . meow-global-mode)
  :demand t
  :config
  (meow/setup-qwerty)
  (bind-keys :map meow-keymap ([remap describe-key] . helpful-key))
  (meow-define-keys
   'normal
   '("s" . avy-goto-char)
   '("F" . avy-goto-char-2)))
#+end_src
** baosize
*** awesome-tray
æ‡’çŒ«çš„åº•éƒ¨çŠ¶æ€æ ï¼Œä»£æ›¿ =modeline= ï¼Œä¸ =sort-tab= ä¸€æ ·ä»¥æœ€å°çª—å£ç©ºé—´å ç”¨ä¸ºç†å¿µã€‚
**** config.el
:PROPERTIES:
:header-args: :tangle modules/baosize/awesome-tray/config.el
:END:
ç»™é»˜è®¤æ¨¡å—åŠ å›¾æ ‡ã€‚
#+begin_src emacs-lisp
;;; config.el -*- lexical-binding: t; -*-
#+end_src
æ˜¾ç¤º =lsp-bridge= çŠ¶æ€å’Œè¯Šæ–­æ•°ç›®
#+begin_src emacs-lisp
(defun awesome-tray-lsp-module () (if (not (equal lsp-bridge-mode nil))
  (if (not (equal lsp-bridge-diagnostic-count nil))
      (concat "ï„µ " (int-to-string lsp-bridge-diagnostic-count))
      "ïš ")
  ""))
(defface awesome-tray-module-lsp-face
  '((((background light)) :inherit awesome-tray-orange-face)
    (t :inherit awesome-tray-orange-face))
  "Lsp-bridge face."
  :group 'awesome-tray)
#+end_src
æ˜¾ç¤ºå½“å‰å…‰æ ‡æ‰€åœ¨å‡½æ•°
#+begin_src emacs-lisp
(defun awesome-tray-mybelong-module ()
    (let ((origin (if (modulep 'treesit)
      (let ((current-seconds (awesome-tray-current-seconds)))
        (if (or (not (eq (current-buffer) awesome-tray-belong-last-buffer))
                (> (- current-seconds awesome-tray-belong-last-time) awesome-tray-belong-update-duration))
            (progn
              (setq awesome-tray-belong-last-time current-seconds)
              (setq awesome-tray-belong-last-buffer (current-buffer))
              (awesome-tray-update-belong-cache))
          awesome-tray-belong-cache))"")))
        (if (equal origin "") "" (concat "ó°¡± " origin))))
#+end_src
æ˜¾ç¤º =meow= çŠ¶æ€
#+begin_src emacs-lisp
(defun awesome-tray-mymeow-module ()
  (let ((origin (with-demoted-errors
      ""
    (if (and (modulep 'meow) awesome-tray-meow-show-mode)
        meow--indicator
      ""))))
    (concat "ó°„›" origin)))
#+end_src
æ˜¾ç¤º =Git= çŠ¶æ€
#+begin_src emacs-lisp
(defun awesome-tray-mygit-module ()
  (let ((origin (if (executable-find "git")
      (progn
        (if (not (string= (buffer-file-name) awesome-tray-git-buffer-filename))
            (awesome-tray-git-command-update-cache))
        awesome-tray-git-command-cache)
    "")))
    (if (equal origin "") "" (concat "î™ " origin))))
#+end_src
æ·»åŠ ä¸Šè¿°æ¨¡å—åˆ° =awesome-tray= æ ¸å¿ƒå¹¶æŒ‚ä¸Šå¯åŠ¨æ—¶çš„é’©å­
#+begin_src emacs-lisp
(use-package 'awesome-tray
:hook (doom-after-init . awesome-tray-mode)
:custom
(awesome-tray-buffer-read-only-style "ó°Œ¾ ")
(awesome-tray-mode-line-active-color "#4ea9e6")
(awesome-tray-belong-update-duration 1)
(awesome-tray-active-modules '("winum"
                               "lsp"
                               "input-method"
                               "mybelong"
                               "mymeow"
                               "file-path"
                               "buffer-read-only"
                               "mygit"
                               "ó°¥”"
                               "date"
                               "clock"))
(awesome-tray-input-method-local-style "ã¢")
:config
(add-to-list 'awesome-tray-module-alist
       '("winum" . (awesome-tray-winum-module awesome-tray-winum-module-face)))
(add-to-list 'awesome-tray-module-alist
       '("mybelong" . (awesome-tray-mybelong-module awesome-tray-module-belong-face)))
(add-to-list 'awesome-tray-module-alist
       '("mymeow" . (awesome-tray-mymeow-module awesome-tray-module-meow-face)))
(add-to-list 'awesome-tray-module-alist
       '("mygit" . (awesome-tray-mygit-module awesome-tray-module-git-face)))
(add-to-list 'awesome-tray-module-alist
       '("lsp" . (awesome-tray-lsp-module awesome-tray-module-lsp-face))))
#+end_src
**** packages.el
#+begin_src emacs-lisp :tangle modules/baosize/awesome-tray/packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/baosize/awesome-tray/packages.el
(package! awesome-tray
  :recipe (:host github :repo "manateelazycat/awesome-tray"))
#+end_src
*** blink-search
æ‡’çŒ«çš„å¤šæºæœç´¢ï¼Œæ®è¯´å¾ˆå¿«å°±å¯ä»¥å–ä»£ =vertico+consult= å…¨å®¶æ¡¶äº†ã€‚
**** config.el
:PROPERTIES:
:header-args: :tangle modules/baosize/blink-search/config.el
:END:
å£°æ˜
#+begin_src emacs-lisp
;;; $DOOMDIR/modules/baosize/blink-search/config.el -*- lexical-binding: t; -*-
(use-package blink-search
#+end_src
ç”±äºæŸç§åŸå› ï¼Œ =blink-search= ä¸èƒ½æ­£å¸¸åŠ è½½ï¼Œéœ€è¦æŒ‡å®š =load-path= ã€‚
æ³¨æ„å¦‚æœæŠŠ Doom å®‰è£…åœ¨ =~/.config/emacs= éœ€è¦æ›´æ”¹ä½ç½®ã€‚
#+begin_src emacs-lisp
:load-path "~/.emacs.d/.local/straight/repos/blink-search/"
#+end_src
ç»‘å®šé”®ä½å°±ä½¿ç”¨é»˜è®¤çš„ =C-M-g= å§ã€‚
#+begin_src emacs-lisp
:bind (("C-M-g" . blink-search))
#+end_src
è¿›å…¥ =blink-search= æ—¶è‚¯å®šå¾—æ˜¯ =meow-insert-mode= å•Š
#+begin_src emacs-lisp
:config (add-hook 'blink-search-mode-hook #'meow-insert))
#+end_src
**** packages.el
#+begin_src emacs-lisp :tangle modules/baosize/blink-search/packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/baosize/blink-search/packages.el
(package! blink-search
  :recipe (:host github :repo "manateelazycat/blink-search"))
#+end_src
*** color-rg
æ‡’çŒ«çš„æœç´¢æ’ä»¶ï¼Œç±»ä¼¼äº =el-search= ï¼Œä½†æ˜¯æ›´æ˜“ç”¨ï¼Œæ›´å¿«
**** config.el
#+begin_src emacs-lisp :tangle modules/baosize/color-rg/config.el
;;; $DOOMDIR/modules/baosize/color-rg/config.el -*- lexical-binding: t; -*-
(use-package color-rg
  :bind
  (("C-c r i" . color-rg-search-input)
   ("C-c r s" . color-rg-search-symbol)
   ("C-c r I" . color-rg-search-input-in-project)
   ("C-c r S" . color-rg-search-symbol-in-project)
   ("C-c r b" . color-rg-search-input-in-current-file)
   ("C-c r j" . color-rg-search-symbol-in-current-file)
   ("C-c r t" . color-rg-search-project-with-type)
   ("C-c r x" . color-rg-search-symbol-with-type)))
#+end_src
**** packages.el
#+begin_src emacs-lisp :tangle modules/baosize/color-rg/packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/baosize/color-rg/packages.el
(package! color-rg
  :recipe (:host github :repo "manateelazycat/color-rg"))
#+end_src
*** EAF
=Emacs Application Frames= ï¼Œç”±æ‡’çŒ«å¼€å‘çš„ä½¿ "Live in Emacs" æˆä¸ºç°å®çš„è¶…çº§åº”ç”¨æ¡†æ¶ï¼Œä¹Ÿæ˜¯æœ¬é…ç½®çš„æ ¸å¿ƒä¹‹ä¸€ã€‚
**** config.el
:PROPERTIES:
:header-args: :tangle modules/baosize/eaf/config.el
:END:
#+begin_src emacs-lisp
;;; baosize/eaf/config.el -*- lexical-binding: t; -*-
#+end_src
åˆ¤æ–­æ˜¯å¦æ˜¯ç»ˆç«¯ï¼Œæ˜¯åˆ™ä¸åŠ è½½ EAF ä»¥èŠ‚çœå¯åŠ¨æ—¶é—´
#+begin_src emacs-lisp
(when (and (display-graphic-p) (not (daemonp)))
#+end_src
å¯åŠ¨ EAF æ¡†æ¶
#+begin_src emacs-lisp
(use-package eaf
  :after-call doom-after-init-hook
  :hook
  (eaf-mode . doom-modeline-mode)
  :init
  (bind-keys ("C-c ee" . eaf-open-this-buffer)
             ("C-c ef" . eaf-open)
             ("C-c em" . eaf-open-bookmark)))
#+end_src
å¯åŠ¨æµè§ˆå™¨ï¼ˆè¿™ä¹ˆå¤§ä¸€ä¸ªåŒ…ï¼Œè‚¯å®šå¾—æ‡’åŠ è½½ï¼‰
#+begin_src emacs-lisp
(use-package eaf-browser
#+end_src
è‡ªå®šä¹‰å¤–è§‚
#+begin_src emacs-lisp
  :custom
  ;;eaf-browser-dark-mode t
  (eaf-browser-default-search-engine "bing")
  (eaf-webengine-font-family "VictorMono Nerd Font")
  (eaf-webengine-fixed-font-family "VictorMono Nerd Font")
  (eaf-webengine-serif-font-family "VictorMono Nerd Font")
  (eaf-webengine-font-size 16)
  (eaf-webengine-fixed-font-size 16)
#+end_src
è‡ªå®šä¹‰æœç´¢å¼•æ“
#+begin_src emacs-lisp
  (eaf-browser-search-engines '(("bing" . "https://bing.com/search?q=%s"))
                               ("baidu" . "https://www.baidu.com/search?ie=utf-8&q=%s")
                               ("google" . "http://www.google.com/search?ie=utf-8&q=%s")
                               ("duckduckgo" . "https://duckduckgo.com/?q=%s"))
#+end_src
ESC é€€å‡ºç„¦ç‚¹
#+begin_src emacs-lisp
  :config
  (eaf-bind-key clear_focus "<escape>" eaf-browser-keybinding)
#+end_src
æ´›è°·å°æ’ä»¶ğŸ˜…
#+begin_src emacs-lisp
  (defun luogu-open-problem (pid)
    (interactive "M[Luogu] ProblemID: ")
    (require 'eaf-browser)
    (eaf-open-browser (concat "https://www.luogu.com.cn/problem/" pid)))
  (defun luogu-open-discuss (did)
    (interactive "M[Luogu] DiscussID: ")
    (require 'eaf-browser)
    (eaf-open-browser (concat "https://www.luogu.com.cn/discuss/" did)))
  (defun luogu-open-training (tid)
    (interactive "M[Luogu] TrainingID: ")
    (require 'eaf-browser)
    (eaf-open-browser (concat "https://www.luogu.com.cn/training/" tid)))
  (defun luogu-open-user-home (uid)
    (interactive "M[Luogu] UserID: ")
    (require 'eaf-browser)
    (eaf-open-browser (concat "https://www.luogu.com.cn/user/" uid)))
  (defun luogu-open-contest (cid)
    (interactive "M[Luogu] ContestID: ")
    (require 'eaf-browser)
    (eaf-open-browser (concat "https://www.luogu.com.cn/contest/" cid)))
  (defun luogu-open-team (teamid)
    (interactive "M[Luogu] TeamID: ")
    (require 'eaf-browser)
    (eaf-open-browser (concat "https://www.luogu.com.cn/team/" teamid)))
#+end_src
æµè§ˆå™¨é”®ç»‘å®š
#+begin_src emacs-lisp
  :bind (("C-c e b" . eaf-open-browser)
         ("C-c e h" . eaf-open-browser-with-history)
         ("C-c e B" . eaf-open-browser-other-window)
         ("C-c e s" . eaf-open-browser-same-window)
         ("C-c elc" . luogu-open-contest)
         ("C-c eld" . luogu-open-discuss)
         ("C-c ele" . luogu-open-team)
         ("C-c elp" . luogu-open-problem)
         ("C-c elt" . luogu-open-training)
         ("C-c elu" . luogu-open-user-home)))
#+end_src
å¯åŠ¨ç»ˆç«¯
#+begin_src emacs-lisp
(use-package eaf-pyqterminal
#+end_src
è®¾ç½®å¤–è§‚
#+begin_src emacs-lisp
  :custom
  (eaf-pyqterminal-font-size 16)
  (eaf-pyqterminal-font-family "VictorMono Nerd Font")
#+end_src
ç»ˆç«¯é”®ç»‘å®š
#+begin_src emacs-lisp
  :bind (("C-c e t" . eaf-open-pyqterminal)
         ("C-c e i" . eaf-open-ipython)))
#+end_src
æ–‡ä»¶ç®¡ç†å™¨é”®ç»‘å®š
#+begin_src emacs-lisp
(use-package eaf-file-manager
 :bind (("C-c e /" . eaf-open-in-file-manager)))
#+end_src
ç›®å‰å­˜åœ¨æ²¡ä¿®å¥½çš„ bug çš„ä¸€äº›åŒ…
#+begin_src emacs-lisp
;; (setq eaf-pdf-dark-mode t)
;; (use-package eaf-git :bind (("C-c e g" . eaf-open-git)))
;; (add-hook org-mode (lambda () (progn (setq eaf-org-dark-mode t) (require 'eaf)(require 'eaf-org-previewer))))
;; (add-hook markdown-mode (lambda ()(progn (setq eaf-markdown-dark-mode t) (require 'eaf)(require 'eaf-markdown-previewer))))
)
#+end_src
**** packages.el
:PROPERTIES:
:header-args: :tangle modules/baosize/eaf/packages.el
:END:
#+begin_src emacs-lisp
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/baosize/eaf/packages.el
#+end_src
eaf éœ€è¦ç¼–è¯‘ç›¸å…³ä¾èµ–
#+begin_src emacs-lisp
(defun +eaf-install-deps-for-app(app-dir)
  "Install deps from dependencies.json."
  (let* ((deps-dict (with-temp-buffer
                      (insert-file-contents
                       (expand-file-name "dependencies.json" app-dir))
                      (json-parse-string (buffer-string))))
         (pip-deps (gethash (if IS-LINUX "linux" "darwin")
                            (or (gethash "pip" deps-dict)
                                (make-hash-table))))
         (vue-install (gethash "vue_install" deps-dict))
         (npm-install (gethash "npm_install" deps-dict))
         (npm-rebuild (gethash "npm_rebuild" deps-dict)))
    (when pip-deps
      (dolist (pkg (append pip-deps nil))
        (message "%s" (shell-command-to-string (format "pip install %s" pkg)))))
    (when vue-install
      (let ((default-directory app-dir))
        (message "%s" (shell-command-to-string "npm install"))
        (message "%s" (shell-command-to-string "npm run build"))))
    (when npm-install
      (let ((default-directory app-dir))
        (message "%s" (shell-command-to-string "npm install"))))
    (when npm-rebuild
      (let ((default-directory app-dir))
        (message "%s" (shell-command-to-string "npm rebuild"))))))
#+end_src
å®‰è£… eaf æ ¸å¿ƒ
#+begin_src emacs-lisp
(package! eaf
  :recipe (:host github :repo "emacs-eaf/emacs-application-framework"
           :files ("*")
           :post-build
           (shell-command "python install-eaf.py --install-core-deps")))
#+end_src
å®‰è£…æµè§ˆå™¨
#+begin_src emacs-lisp
(package! eaf-browser
  :recipe (:host github :repo "emacs-eaf/eaf-browser"
           :files ("*")
           :post-build
           (+eaf-install-deps-for-app
            (concat straight-base-dir "/straight/" straight-build-dir "/eaf-browser"))))
#+end_src
å®‰è£…ç»ˆç«¯
#+begin_src emacs-lisp
(package! eaf-pyqterminal
  :recipe (:host github :repo "mumu-lhl/eaf-pyqterminal"
           :files ("*")
           :post-build
           (+eaf-install-deps-for-app
            (concat straight-base-dir "/straight/" straight-build-dir "/eaf-pyqterminal"))))
#+end_src
å®‰è£…æ–‡ä»¶ç®¡ç†å™¨
#+begin_src emacs-lisp
(package! eaf-file-manager
  :recipe (:host github :repo "emacs-eaf/eaf-file-manager"
           :files ("*")
           :post-build
           (+eaf-install-deps-for-app
            (concat straight-base-dir "/straight/" straight-build-dir "/eaf-file-manager"))))
#+end_src
ä¸€äº›æœ‰ bug çš„åŒ…
#+begin_src emacs-lisp
;;(package! eaf-org-previewer
;;  :recipe (:host github :repo "emacs-eaf/eaf-org-previewer"
;;           :files ("*")
;;           :post-build
;;           (+eaf-install-deps-for-app
;;            (concat straight-base-dir "/straight/" straight-build-dir "/eaf-org-previewer"))))
;;(package! eaf-markdown-previewer
;;  :recipe (:host github :repo "emacs-eaf/eaf-markdown-previewer"
;;           :files ("*")
;;           :post-build
;;           (+eaf-install-deps-for-app
;;            (concat straight-base-dir "/straight/" straight-build-dir "/eaf-markdown-previewer"))))
;;(package! eaf-pdf-viewer
;;  :recipe (:host github :repo "emacs-eaf/eaf-pdf-viewer"
;;           :files ("*")
;;           :post-build
;;           (+eaf-install-deps-for-app
;;            (concat straight-base-dir "/straight/" straight-build-dir "/eaf-pdf-viewer"))))
;;(package! eaf-git
;;  :recipe (:host github :repo "emacs-eaf/eaf-git"
;;           :files ("*")
;;           :post-build
;;           (+eaf-install-deps-for-app
;;            (concat straight-base-dir "/straight/" straight-build-dir "/eaf-git"))))
#+end_src
*** holo-layer
æ‡’çŒ«å¼€å‘çš„å„ç§ç‰¹æ•ˆï¼Œæ²¡æœ‰å‡† =Linux= ç¯å¢ƒæ‰€ä»¥ç›®å‰å”¯ä¸€æˆåŠŸçš„ç¯å¢ƒæ˜¯ =wslg+sway= ã€‚
è¿™ä¸ªæ¨¡å—ä¼šç ´å =blink-search= çš„çª—å£ï¼Œä¸å»ºè®®å¯ç”¨ã€‚
**** config.el
:PROPERTIES:
:header-args: :tangle modules/baosize/holo-layer/config.el
:END:
#+begin_src emacs-lisp
;;; baosize/holo-layer/config.el -*- lexical-binding: t; -*-
#+end_src
è§£å†³æ‰¾ä¸åˆ°å‡½æ•°çš„ bug
#+begin_src emacs-lisp
(add-to-list 'load-path "~/.emacs.d/.local/straight/repos/blink-search/backend/")
#+end_src
å¯åŠ¨ =holo-layer=
#+begin_src emacs-lisp
(use-package holo-layer
  :custom
  (holo-layer-enable-cursor-animation t)
  (holo-layer-enable-type-animation t)
  (holo-layer-enable-indent-rainbow t)
  (holo-layer-cursor-color t)
  (holo-layer-cursor-alpha 255)
  (holo-layer-type-animation-style 'supernova)
  (holo-layer-sort-tab-ui)
  :config
  (holo-layer-enable))
#+end_src
**** packages.el
#+begin_src emacs-lisp :tangle modules/baosize/holo-layer/packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/baosize/holo-layer/packages.el
(package! holo-layer
  :recipe (:host github :repo "manateelazycat/holo-layer"
           :files ("*")))
#+end_src
*** sort-tab
æ‡’çŒ«çš„æ ‡ç­¾æ ï¼Œå¯ç”¨ =holo-layer= å³å¯æ˜¾ç¤ºå›¾æ ‡
**** config.el
#+begin_src emacs-lisp :tangle modules/baosize/sort-tab/config.el
;;; $DOOMDIR/modules/baosize/sort-tab/config.el -*- lexical-binding: t; -*-
(use-package sort-tab
;;  :defer t
  :hook
  (doom-after-init . sort-tab-mode)
  :init
  (bind-keys ("C-c b]" . sort-tab-select-next-tab)
        ("C-c bn" . sort-tab-select-next-tab)
        ("C-c b[" . sort-tab-select-prev-tab)
        ("C-c bp" . sort-tab-select-prev-tab)
        ("C-c bl" . sort-tab-select-last-tab)
        ("C-c bK" . sort-tab-close-all-tabs)
        ("C-c bO" . sort-tab-close-other-tabs)
        ("C-c bd" . sort-tab-close-current-tab)
        ("C-c bk" . sort-tab-close-current-tab)))
#+end_src
**** packages.el
#+begin_src emacs-lisp :tangle modules/baosize/sort-tab/packages.el
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/baosize/sort-tab/packages.el
(package! sort-tab
  :recipe (:host github :repo "manateelazycat/sort-tab"))
#+end_src
*** chinese
è®¾ç½® emacs-rime è¾“å…¥æ³•ï¼Œ Rime åœ¨ =~/.local/share/emacs-rime= æ–‡ä»¶å¤¹ä¸­è®¾ç½®ã€‚ 
**** config.el
:PROPERTIES:
:header-args: :tangle modules/baosize/chinese/config.el
:END:
#+begin_src emacs-lisp
;;; baosize/chinese/config.el -*- lexical-binding: t; -*-
#+end_src
ä½¿ç”¨ =ace-pinyin= ä»¥æ”¯æŒ =avy= è·³è½¬åˆ°ä¸­æ–‡
ä½¿ç”¨ =pinyin-lib= ä»¥æ”¯æŒ =consult= æœç´¢ä¸­æ–‡
#+begin_src emacs-lisp
(use-package ace-pinyin
  :after avy
  :init (setq ace-pinyin-use-avy t)
  :config (ace-pinyin-global-mode t))
(use-package pinyinlib
  :commands (pinyinlib-build-regexp-string)
  :init
  (defun orderless-regexp-pinyin (str)
    (setf (car str) (pinyinlib-build-regexp-string (car str)))
    str)
  (advice-add 'orderless-regexp :filter-args #'orderless-regexp-pinyin))
#+end_src
ç¦ç”¨ç³»ç»Ÿè¾“å…¥æ³•
=Fcitx5= ä»€ä¹ˆçš„åœ¨ =Emacs= ä¸Šçš„ä½“éªŒå¾ˆä¸å¥½ã€‚
#+begin_src emacs-lisp
; disable gtk im modules for emacs-pgtk, add "Emacs*UseXIM: false" to ~/.Xresources to disable xim
(when (boundp 'pgtk-use-im-context-on-new-connection)
  (setq pgtk-use-im-context-on-new-connection nil))
#+end_src
=use-package= å£°æ˜
#+begin_src emacs-lisp
(use-package rime
#+end_src
é”®ç»‘å®š
#+begin_src emacs-lisp 
  :bind
  (:map rime-mode-map ("C-`" . #'rime-send-keybinding))
#+end_src
è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•
#+begin_src emacs-lisp
  :custom
  (rime-disable-predicates
      '(rime-predicate-evil-mode-p
           meow-normal-mode-p
           meow-keypad-mode-p
           meow-motion-mode-p
           rime-predicate-hydra-p
           rime-predicate-prog-in-code-p
           rime-predicate-space-after-cc-p
           rime-predicate-org-in-src-block-p
           rime-predicate-org-latex-mode-p
           rime-predicate-punctuation-after-space-cc-p
           rime-predicate-punctuation-after-ascii-p
           rime-predicate-punctuation-line-begin-p
           ;; rime-predicate-space-after-ascii-p
           ;; rime-predicate-space-after-cc-p
           rime-predicate-after-ascii-char-p))
#+end_src
Rime æœ¬èº«ç›¸å…³è®¾ç½®
#+begin_src emacs-lisp
  ;; (rime-share-data-dir
  ;;  (cl-some (lambda (dir)
  ;;             (let ((abs-dir (expand-file-name dir)))
  ;;               (when (file-directory-p abs-dir)
  ;;                 abs-dir)))
  ;;           '("/usr/share/rime-data"
  ;;             "/usr/share/local"
  ;;             "/usr/share")))
  (rime-user-data-dir (expand-file-name "~/.local/share/emacs-rime"))
  (rime-show-candidate 'posframe)
  (rime-posframe-style 'vertical)
#+end_src
è®¾ç½®é»˜è®¤è¾“å…¥æ³•
#+begin_src emacs-lisp
(default-input-method "rime")
#+end_src
=Org-mode= è‡ªå¯åŠ¨
#+begin_src emacs-lisp
 :config
 (add-hook 'org-mode-hook (lambda () (activate-input-method default-input-method)))
#+end_src
é˜²æ­¢å µå¡ã€å†»ç»“ =Emacs=
#+begin_src emacs-lisp
(add-hook 'kill-emacs-hook (lambda () (ignore-errors (rime-lib-finalize)))))
#+end_src
**** packages.el
#+begin_src emacs-lisp :tangle modules/baosize/chinese/packages.el 
;; -*- no-byte-compile: t; -*-
;;; $DOOMDIR/modules/baosize/chinese/packages.el


(package! rime)
(package! ace-pinyin)
(package! pinyinlib)
(when (modulep! :editor evil) (package! evil-pinyin))
#+end_src
*** lsp
*** mycorfu
*** themes
*** tools
*** treesit-context
*** vterm-run
